# Структура системи та її компоненти. 
Система CetnralParking - це система пошуку, оплати, моніторингу та контролю за парковками у Львові. Вона призначена для регулювання насиченості парковок ціновим методом для створення зручних умов паркування жителям та гостям Львова.

Компоненти системи можна розбити на три логічні групи: клієнтська частина (веб-сайт, паркомати), серверна частина з базою даних та додаткові сервіси взаємодії з системою (банківська система оплати, інтернет-карти). 

###Клієнтська частина 
Організована з трьох видів реалізації взаємодії з системою:
- веб-сайт
- паркомати
- послуги смс-оплати

*Веб-сайт* 
Веб-сайт park.lviv.ua є інтерфейсом взаємодії між клієнтом та системою за допомогою інтернету. Веб-сайт має наступні можливості: 
- надає можливість оплати паркування після вказанання клієнтом місця і часу стоянки, номеру авто. Оплата здійснюється через одну з систем оплат за допомогою платіжних карточок чи онлайн-сервісів. У відподвідь відображає детальний чек, на якому вказані:
	* дата оплати 
	* сума оплати 
	* час, до якого оплачена стоянка
	* номер авто, на яке оплачена стоянка
	* номер транзакції (сервісний номер операції оплати системи паркування) 
- надає можливість перегляду тарифного графіку для конкретної парковки
- надає можливість пошуку парковки на заданий час з вказаними ціновими обмеженнями (наприклад для здешевлення нічного паркування)
- надає відомості прор умови використання даного сервісу та містить всю необхідну контактну інформацію.

*Паркомати*
Паркомати - спеціалізовані статичні пристрої оплати парковки, вмонтовані безпосередньо біля парковок. Логіка їхньої роботи є аналогічною функції оплати на сайті, проте способом оплати за порковку є готівка, яка вноситься в купюроприймач. Паркомат друкує чек, аналогічний веб-сайтові. 
Паркомати повинні бути вандалозахищені, пристосовані до функціонування у надвірних умовах і мати постійне зєднання з електромережею і інтернетом. 
Процес взаємодії паркомата і центрального сервера: 
1. Заповнення необхідних даних (тремін парковки, номер паркомісця, номер авто) -> 2. Встановлення захищеного зєднання з сервером -> 3. Відсилання даних серверові -> 4. Підвердження прийому даних сервером -> 5. Прийом купюр у купюроприймач -> 6. Підтвердження одержання грошей серверові -> 7. Підтвердження сервером реєстрації купівлі -> 8. Друк чеку. 

*Послуги смс-оплати*
Послуга смс-оплати призначена для оплати за парковку за рахунок коштів мобільного рахунку при відсиланні номера авто і номера місця на відповідний номер, який визначає термін парковки, за який здійснюється оплата. 
У випадку успіхного проходження транзакції у відповідь приходить смс з підтвердженням. 
При оплаті парковки смс-центер інфомрує центральний сервер про здійснену операцію на що сервер вносить відповідний запис у БД.


### Серверна частина та БД
Сервер повинен обслуговувати сайт, вести оплату через паркомати, комунікувати з банками, картами та іншими зовнішніми сервісами, керувати базою даних.
Основною мовою, на якій написаний сервер є Python 2.7.4 з відповідними фреймворками у кожній з частин. 
Сервер складається з наступних логічних компонентів: 
*Models* 
Опис бази даних та роботи з нею за допомогою ORM. Використовується orm-система SqlAlchemy.
*Service-layer* 
Містить функції які є внутрішньосерверними, не комунікують з зовнішніми сервісами, керуються контролерами. Вони виконують безпосереднє оброблення даних, виконують математичні підрахунки. Ці функції повинні бути недоступні для будь-яких зовнішніх систем. 
*Templates*
Використовуються для генерування html сторінок на веб-сайті. Згідно архітектури містить окремо виділені html-файли, javascript-файли, css-файли та встановлені бібліоеки.
*Views*
Основні функції серверу (у інших ноатціях - Controllers), які відповідають на запити використовуючи необхідні частини серверу. 
Написані з використанням фреймворку Flask. Викликаються звертанням за певною url-адерсою.  


### Додаткові зовнішні сервіси
До додаткових зовнішніх сервісів на даний час належать системи інтернет-оплати банків-партнерів (наприклад Privat24) та інших інтернет-систем оплати, а також онлайн-карти.
При використанні інтернет-оплати сервіс здійснює перенаправлення клієнта на сторінку партнера. Після операції сервіс надсилає серверові результат і повертає на сторінку системи паркування. 
Онлайн-карти використовуються для візуалізації розташування та насиченості парковок по містку. Також планується реалізувати функцію прокладання маршруту до вибраної парковки. 


#Фізичний вигляд парковки і представлення в системі

Фізично паркомісцями є відведені місця вулиць, які позначені інформативними табличками з певною періодичністю та розміткою на дорозі(при можливості). На табличках вказано цінову політику паркування, методи оплати та як вони виконуються, та додаткову інформацію для водіїв.
В системі інформація про паркомісця міститься в базі даних. Це безпосередньо номер паркомісця, розташування, місткість та ціни. Інформаці апр заповнення місць та тривалість перебування на них вноситься в окрему таблицю.


#Оплата паркомісця

- Через інтернет;
- Через смс;
- Через кіоск;

![Картинка][image1]
[image1]:https://github.com/caujka/CentralPark/tree/master/docs/img/dymae1.jpg



***Оплата через інтернет***

Дії:

1) Перейти по адресі CentralPark.Lviv.ua

![Картинка][image2]
[image2]:https://github.com/caujka/CentralPark/tree/master/docs/img/111.jpg

Користувач опиниться на початковій сторінці аплікації, де одразу можна здійснити оплату. Тут присутні поля для ввлду та кнопка переходу до наступного кроку.

2) В вказані поля необхідно ввести номер паркомісця(його користувач бачить безпосередньо на місці паркування) та номер машини.

3) Після цього користувачеві представляються активні тарифи та можливість ввести час в годинах, скільки він буде стояти.

![Картинка][image3]
[image3]:https://github.com/caujka/CentralPark/tree/master/docs/img/222.jpg


4) Ввівши час, аплікація перенаправляє користувача на систему онлайн-платежів, де відбувається безпосередня оплата паркування.

![Картинка][image4]
[image4]:https://github.com/caujka/CentralPark/tree/master/docs/img/333.jpg


5) Після завершення транзакції користувачу представляється сторінка з підтвердженням, де містяться дані: номер машини, номер місця, сума оплати, тривалість паркування (в годинах або до якого конкретно часу).

![Картинка][image5]
[image5]:https://github.com/caujka/CentralPark/tree/master/docs/img/444.jpg



***Оплата через СМС***


Дії:

1) Поставивши машину, користувач на інформативній дошці бачить шаблон смс-повідомлення для оплати парковки.

2) Відправляє смс на вказаний номер.

3) У відповідь отримує підтвердження про оплату у вигляді: #car_number на #parking_nubber може стояти до ##год.

![Картинка][image6]
[image6]:https://github.com/caujka/CentralPark/tree/master/docs/img/mob.jpg

***Оплата через кіоск***

Дії:

1) На екрані демонструються тарифи парковки та форма для оплати.

![Картинка][image7]
[image7]:https://github.com/caujka/CentralPark/tree/master/docs/img/parkom.png

2) Користувач вводить номер машини, суму грошей, що хоче заплатити.

- Або вносить готівку; 
- або картку та вводить пін-код.

3) На екрані зявляється інформація про оплату за конкретне місце для вказаної машини і відправка запиту на підтвердження.

4) На виході каристувач отримує чек про оплату та свою картку.



###Інспектування 

================
Перевірка оплати
================

1) Loсation API (наприклад Google Maps Geolocation API, Geoloqi API чи інші) визначає місцезнаходження авторизованого інспектора.

2) Відносно визначеного місця інспектору демонструється список користувачів, які оплатили місце. Інформація подається у вигляді записів, що містять номер машини, номер місця, до якого часу оплачено.

3) На даній сторінці також є можливість зафіксувати порушення. Кнопка активує камеру, інспектор фотографує порушника (а саме номер машини та на якому місці припаркований). Відповідний сервіс фіксує час на фотографіях, і дані відправляються в процесинговий центр.


# API
В майбутньому буде 2 основних API: інтернет-банкінг, наприклад Приват24, та Google-maps. Перше буде використовуватись в якості 
засобу оплати користувачами послуг. Друге - для візуалізації місцезнаходження парковок, прокладання маршруту та user-friendly 
інтерфейсу. 

# Hardware configuration
* Main Server - 1 GHz processor x86 (32 bit or 64 bit) or ARM; 1 GB of RAM; 5.9 gigabytes of hard drive space or better
* Static Server - 1 GHz processor x86 (32 bit or 64 bit) or ARM; 1 GB of RAM; 10 gigabytes of hard drive
* DatabaseServer - 2 or more CPU cores, 2 or more GB of RAM, Disk I/O subsystem applicable for a write-intensive database

# Software configuration
* Main Server - Ubuntu 12.04, Python 2.7.6, sqlalchemy, Flask 0.10
* Static Server - Linux, static server (Apache or lighttpd or Cherokee)
* DatabaseServer - Linux, MySql

# Робота з помилками
1) Сервер
* втрата звязку з базою даних
	* повернути клієнту повідомлення "сервіс тимчасово не працює", записати в лог файл помилку, повідомити адміністратора ресурса (e-mail, sms etc.)
* втрата звязку зі статичним сервером
	* повернути клієнту мінімалістичну версію сайта без використання javascript-а і валідації на клієнті, повідомити адміністратора ресурса (e-mail, sms etc.)

2) Банк і системи оплати
* нема зязку з банківскою системою
	* в клієнта неактивне відповідне меню

# Тестування
1) Ручне тестування
* Введення даних в форми
- Введення пустих полів
- Введення некоректиних даних (замість суми грошей - літери)
- Натискання по всім можливим кнопкам 
* Посилка запитів з консолі (обхід валідації на фронтенді)
- Посилка POST чи GET запитів для додавання інформації в базу чи діставання потрібної інформації

2) Автоматичне тестування
* автоматизація введень даних в форми і натисканнь на клавіші
* автоматизація надсилання запитив (curl - скрипти)
* unit та doc-тести

# Валідація
Валідація проходить і на клієнті, і на сервері. Frontend перевіряє чи всі обов'язкові поля заповнені, чи немає в полі, що призначене для грошей, літер. Backend валідація запобігає введенню неправильних 
даних з консолі, наприклад за допомогою curl чи через консоль браузера. На сервері виконуються ті самі дії по перевірці правильності введення даних. 
Окремо треба виділити валідацію оплати через інтернет-банкінг. Після введення даних про стоянку на сторінці оплати,
користувача перенаправляють на сторінку банківської служби, де його просять ввести дані картки. Після успішного введення даних 
та оплати, його перенаправляють на наш сервіс, де користувача повідомляють про успішність операції і виводиться інформація про 
результат оплати.     

