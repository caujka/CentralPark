# Структура системи та її компоненти. 
Система CetnralParking - це система пошуку, оплати, моніторингу та контролю за парковками у Львові. Вона призначена для регулювання насиченості парковок ціновим методом для створення зручних умов паркування жителям та гостям Львова.

Компоненти системи можна розбити на три логічні групи: клієнтська частина (веб-сайт, паркомати), серверна частина з базою даних та додаткові сервіси взаємодії з системою (банківська система оплати, інтернет-карти). 

###Клієнтська частина 
Організована з трьох видів реалізації взаємодії з системою:
- веб-сайт
- паркомати
- послуги смс-оплати

*Веб-сайт* 
Веб-сайт park.lviv.ua є інтерфейсом взаємодії між клієнтом та системою за допомогою інтернету. Веб-сайт має наступні можливості: 
- надає можливість оплати паркування після вказанання клієнтом місця і часу стоянки, номеру авто. Оплата здійснюється через одну з систем оплат за допомогою платіжних карточок чи онлайн-сервісів. У відподвідь відображає детальний чек, на якому вказані:
	* дата оплати 
	* сума оплати 
	* час, до якого оплачена стоянка
	* номер авто, на яке оплачена стоянка
	* номер транзакції (сервісний номер операції оплати системи паркування) 
- надає можливість перегляду тарифного графіку для конкретної парковки
- надає можливість пошуку парковки на заданий час з вказаними ціновими обмеженнями (наприклад для здешевлення нічного паркування)
- надає відомості прор умови використання даного сервісу та містить всю необхідну контактну інформацію.

*Паркомати*
Паркомати - спеціалізовані статичні пристрої оплати парковки, вмонтовані безпосередньо біля парковок. Логіка їхньої роботи є аналогічною функції оплати на сайті, проте способом оплати за порковку є готівка, яка вноситься в купюроприймач. Паркомат друкує чек, аналогічний веб-сайтові. 
Паркомати повинні бути вандалозахищені, пристосовані до функціонування у надвірних умовах і мати постійне зєднання з електромережею і інтернетом. 
Процес взаємодії паркомата і центрального сервера: 
1. Заповнення необхідних даних (тремін парковки, номер паркомісця, номер авто) -> 2. Встановлення захищеного зєднання з сервером -> 3. Відсилання даних серверові -> 4. Підвердження прийому даних сервером -> 5. Прийом купюр у купюроприймач -> 6. Підтвердження одержання грошей серверові -> 7. Підтвердження сервером реєстрації купівлі -> 8. Друк чеку. 

*Послуги смс-оплати*
Послуга смс-оплати призначена для оплати за парковку за рахунок коштів мобільного рахунку при відсиланні номера авто і номера місця на відповідний номер, який визначає термін парковки, за який здійснюється оплата. 
У випадку успіхного проходження транзакції у відповідь приходить смс з підтвердженням. 
При оплаті парковки смс-центер інфомрує центральний сервер про здійснену операцію на що сервер вносить відповідний запис у БД.


### Серверна частина та БД
Сервер повинен обслуговувати сайт, вести оплату через паркомати, комунікувати з банками, картами та іншими зовнішніми сервісами, керувати базою даних.
Основною мовою, на якій написаний сервер є Python 2.7.4 з відповідними фреймворками у кожній з частин. 
Сервер складається з наступних логічних компонентів: 
*Models* 
Опис бази даних та роботи з нею за допомогою ORM. Використовується orm-система SqlAlchemy.
*Service-layer* 
Містить функції які є внутрішньосерверними, не комунікують з зовнішніми сервісами, керуються контролерами. Вони виконують безпосереднє оброблення даних, виконують математичні підрахунки. Ці функції повинні бути недоступні для будь-яких зовнішніх систем. 
*Templates*
Використовуються для генерування html сторінок на веб-сайті. Згідно архітектури містить окремо виділені html-файли, javascript-файли, css-файли та встановлені бібліоеки.
*Views*
Основні функції серверу (у інших ноатціях - Controllers), які відповідають на запити використовуючи необхідні частини серверу. 
Написані з використанням фреймворку Flask. Викликаються звертанням за певною url-адерсою.  


### Додаткові зовнішні сервіси
До додаткових зовнішніх сервісів на даний час належать системи інтернет-оплати банків-партнерів (наприклад Privat24) та інших інтернет-систем оплати, а також онлайн-карти.
При використанні інтернет-оплати сервіс здійснює перенаправлення клієнта на сторінку партнера. Після операції сервіс надсилає серверові результат і повертає на сторінку системи паркування. 
Онлайн-карти використовуються для візуалізації розташування та насиченості парковок по містку. Також планується реалізувати функцію прокладання маршруту до вибраної парковки. 




# API
В майбутньому буде 2 основних API: інтернет-банкінг, наприклад Приват24, та Google-maps. Перше буде використовуватись в якості 
засобу оплати користувачами послуг. Друге - для візуалізації місцезнаходження парковок, прокладання маршруту та user-friendly 
інтерфейсу. 




# Тестування
- Ручне тестування
	* Введення даних в форми
	* Посилка запитів з консолі (обхід валідації на фронтенді)
- Автоматичне тестування
	* автоматизація введень даних в форми
	* автоматизація надсилання запитив (curl - скрипти)
	* unit та doc-тести




# Validation
Валідація проходить і на клієнті, і на сервері. Frontend перевіряє чи всі обов'язкові поля заповнені, чи немає в полі, що призначене для грошей, літер. Backend валідація запобігає введенню неправильних даних з консолі, наприклад за допомогою curl чи через консоль браузера. На сервері виконуються ті самі дії по перевірці правильності введення даних. 
Окремо треба виділити валідацію оплати через інтернет-банкінг. Після введення даних про стоянку на сторінці оплати,
користувача перенаправляють на сторінку банківської служби, де його просять ввести дані картки. Після успішного введення даних 
та оплати, його перенаправляють на наш сервіс, де користувача повідомляють про успішність операції і виводиться інформація про 
результат оплати.     

